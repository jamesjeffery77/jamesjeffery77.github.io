{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"url": "https://raw.githubusercontent.com/jamesjeffery77/jamesjeffery77.github.io/main/pls.csv"},
    "title": {
    "text": "A change in electricity generation",
    "subtitle": "UK Emissions and the cause of its reduction, Data: BEIS, Ourworldindata.org",
    "subtitleFontStyle": "italic",
    "subtitleFontSize": 11,
    "anchor": "start",
    "color": "black"
  },
  "transform": [{
  "calculate": "if(datum.type === 'co2_actual', 0, if(datum.type === 'difference', 1, 2))",
    "as": "siteOrder"
  }],
  "width": 300,
  "height": 300,
  "encoding": {
    "x": {"field": "Year",
    "type": "temporal",
    "title":"Year"}},
  "layer": [
    {
      "encoding": {
        "color": {"field": "type", "type": "nominal"},
        "y": {"field": "emissions", "type": "quantitative",
        "title":"Emissions (MtCO2)",
        "scale": {"domain":[0,700]}
        },
            "order": {"field": "siteOrder", "type": "quantitative"},
      "opacity": {"value": 0.7}
      },
      "layer": [
        {"mark": "area"},
        {"transform": [{"filter": {"param": "hover", "empty": false}}], "mark": "point"}
      ]
    },
    {
      "transform": [{"pivot": "type", "value": "emissions", "groupby": ["Year"]}],
      "mark": "rule",
      "encoding": {
        "opacity": {
          "condition": {"value": 0.3, "param": "hover", "empty": false},
          "value": 0
        },
        "tooltip": [
          {"field": "co2_actual", "type": "quantitative", "title":"CO2 emissions in the UK"}
        ]
      },
      "params": [{
        "name": "hover",
        "select": {
          "type": "point",
          "fields": ["Year"],
          "nearest": true,
          "on": "mouseover",
          "clear": "mouseout"
        }
      }]
    }
  ]
}
